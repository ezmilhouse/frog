(function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(n){function u(){!e&&this[r]&&this[r].apply(this,arguments)}var r="_ctor",i=this.prototype;e=!0;var s=new this;e=!1;for(var o in n)s[o]=typeof n[o]=="function"&&typeof i[o]=="function"&&t.test(n[o])?function(e,t){return function(){var n=this._super;this._super=i[e];var r=t.apply(this,arguments);return this._super=n,r}}(o,n[o]):n[o];return u.prototype=s,u.prototype.constructor=u,u.extend=arguments.callee,u}})(),define("src/Inherit",function(){}),define("src/util",["moment","numeral"],function(e,t){var n={codes:{200:"OK",201:"OK_CREATED",202:"OK_ACCEPTED",204:"OK_NO_CONTENT",400:"ERROR_BAD_REQUEST",401:"ERROR_UNAUTHORIZED",403:"ERROR_FORBIDDEN",404:"ERROR_NOT_FOUND",409:"ERROR_CONFLICT",500:"ERROR_INTERNAL_SERVER_ERROR"},date:{formats:{iso:"YYYY-MM-DDTHH:mm:ss.sss",local:{de:"DD.MM.YYYY - HH:mm:ss",de_day:"DD.MM.YYYY"},utc:"MM-DD-YYYY HH:mm:ss ZZ",utcutc:"ddd MMM DD YYYY HH:mm:ss.sss ZZ",utc_parse:"ddd MMM DD YYYY HH:mm:ss.sss ZZ"},local:function(t,r){return r=r||"de",r=n.date.formats.local[r],e(t).local().format(r)},utc:function(){return e.utc().format(n.date.formats.utc)},utcLocal:function(t,r){return t?e.utc(t,r).local().format(n.date.formats.utc):e.utc().local().format(n.date.formats.utc)}},hash:{sha1:function(e){return crypto.createHash("sha1").update(e).digest("hex")}},moment:e,trim:function(e){return typeof e=="undefined"?e:(e=e.toString(),typeof $!="undefined"?$.trim(e):e.replace(/^\s+|\s+$/gm,""))},guid:function(e){e=e||1;var t=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},n=function(){return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},r=[];for(var i=0;i<e;i++)r.push(n());return r},KEYCODE_ESC:27,calc:{timeDiff:function(e){var t=4,n=[];for(var r=0;r<e.length;r++)r-1>=0?n.push(((e[r].time-e[r-1].time)/1e3).toFixed(t)+"s - "+e[r].note):n.push("0.0000s - "+e[r].note);var i=e[e.length-1].time-e[0].time,s={logs:e,total:(i/1e3).toFixed(t),diff:n,text:"Done in "+(i/1e3).toFixed(t)+" seconds."};return s}},deepcopy:function(e){return JSON.parse(JSON.stringify(e))},deepextend:function(){var e=function(e){if(!e||!this.object||e.nodeType)return!1;try{if(e.constructor&&!hasOwn.call(e,"constructor")&&!hasOwn.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}var n;for(n in e);return n===undefined||hasOwn.call(e,n)},t,r,i,s,o,u,a=arguments[0]||{},f=1,l=arguments.length,c=!1;typeof a=="boolean"&&(c=a,a=arguments[1]||{},f=2),typeof a!="object"&&!_.isFunction(a)&&(a={});for(f=0;f<l;f++)if((t=arguments[f])!=null)for(r in t){i=a[r],s=t[r];if(a===s)continue;c&&s&&(e(s)||(o=_.isArray(s)))?(o?(o=!1,u=i&&_.isArray(i)?i:[]):u=i&&e(i)?i:{},a[r]=n.deepextend(c,u,s)):s!==undefined&&(a[r]=s)}return a},format:{date:function(t){return log("Warning: util.format.date() is deprecated (at this location), has to live somewhere else."),e(t).format("DD.MM.YYYY - HH:mm:ss")},number:function(e,n){return log("Warning: util.format.number() is deprecated (at this location), has to live somewhere else."),n=n="de_DE",t.language(n,{delimiters:{thousands:".",decimal:","},currency:{symbol:"â‚¬"}}),t(e).format("0,0")}},isBusy:function(e){return log("Warning: util.isBusy() is deprecated, now handled by Handler.Form"),e=$(e),e.addClass("frog-busy"),!0},isIdle:function(e){return log("Warning: util.isIdle() is deprecated, now handled by Handler.Form"),e=$(e),e.hasClass("frog-busy")?(e.removeClass("frog-busy"),!0):!1},log:{mongo:{down:function(){var t="";t+="\n",t+=e().format("D MMM HH:mm:ss")+" - "+"[mongodb] no connection, service down",console.log(t)},error:function(){var t="";t+="\n",t+=e().format("D MMM HH:mm:ss")+" - "+"[mongodb] error occured",console.log(t)},exit:function(){var t="";t+="\n",t+=e().format("D MMM HH:mm:ss")+" - "+"[mongodb] service exited",console.log(t)},up:function(){var t="";t+="\n",t+=e().format("D MMM HH:mm:ss")+" - "+"[mongodb] connection established",t+="\n",t+=e().format("D MMM HH:mm:ss")+" - "+"[mongodb] service up, runs on http://"+this.host+":"+this.port,console.log(t)}},node:{process:function(t,n){var r="";r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] Process (PID): "+t.pid,r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] Node.js: "+t.versions.node,r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] Running on port "+n+", debug on port "+t.debugPort,r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] Visit at http://localhost:"+n,console.log(r)},exception:function(t,n,r){var i="";i+="\n",r?i+=e().format("D MMM HH:mm:ss")+" - "+"[node] "+t.toUpperCase()+": "+n.stack:i+=e().format("D MMM HH:mm:ss")+" - "+"[node] "+t.toUpperCase()+": "+n,console.log(i)},uncaughtException:function(t,n,r,i){var s="";s+="\n",s+=e().format("D MMM HH:mm:ss")+" - "+"[node] "+status,s+="\n",s+=e().format("D MMM HH:mm:ss")+" - "+"[node] "+t.method+" "+t.url,s+="\n",s+=e().format("D MMM HH:mm:ss")+" - "+"[node] REFERER "+t.headers.referer,s+="\n",s+=e().format("D MMM HH:mm:ss")+" - "+"[node] USER-AGENT "+t.headers["user-agent"],s+="\n",s+=e().format("D MMM HH:mm:ss")+" - "+"[node] "+i.stack,console.log(s)},req:{error:function(t,n){var r="";r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] "+n,r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] "+t.method+" "+t.url,r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] REFERER "+t.headers.referer,r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] USER-AGENT "+t.headers["user-agent"],console.log(r)},success:function(t,n){var r="";r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] "+n,r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] "+t.method+" "+t.url,r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] REFERER "+t.headers.referer,r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] USER-AGENT "+t.headers["user-agent"],console.log(r)}},up:function(){var t="";t+="\n",t+=e().format("D MMM HH:mm:ss")+" - "+"[node] server started",t+="\n",t+=e().format("D MMM HH:mm:ss")+" - "+"[node] service up, runs on http://localhost:"+this.$.port,console.log(t)},workers:{up:function(t){var n="";n+="\n",n+=e().format("D MMM HH:mm:ss")+" - "+"[node] worker up",console.log(n)},down:function(t,n){var r="";r+="\n",r+=e().format("D MMM HH:mm:ss")+" - "+"[node] worker with PID "+n.id+" died, rip, his mother loved him",console.log(r)}}},time:{resources:function(e,t,n){var r=e.get("object");return typeof t[r]=="undefined"&&(t[r]={}),typeof t[r].time=="undefined"&&(t[r].time=[]),t[r].time.push({time:(new Date).getTime(),note:n}),t}}},messages:{"2xx":{"00000":"Request, response, ok.","00001":"X-domain preflight request (OPTIONS), response, ok.","00002":"Web hook request (POST), response, ok."},"4xx":{"00000":"Unknown error.","00001":"Failed to connect to database.","00002":"Document(s) not found.","00003":"Request body not found.","00004":"Request body is missing required keys.","00021":"Request querystring not found.","00022":"Request querystring is missing required keys.","00010":"Resource not found.","00011":"Missing key header.","00012":"","00013":"Missing session header.","00014":"Invalid key header.","00015":"","00016":"HTTP method not allowed.","00017":"Client group not allowed.","00018":"Client key not allowed.","00019":"Client key denied.","00020":"Clients could not be retrieved."}},mouseWheelListener:function(e){log("Warning: util.mouseWheelListener() is deprecated (at this location), has to live somewhere else."),e.preventDefault()},modal:{height:600,cssClass:"frog-modal-default",content:null,outer:null,close:null,mask:null,body:null,afterShow:null,afterHide:null,init:function(e,t){log("Warning: util.modal.init() is deprecated (at this location), has to live somewhere else.");var r=this;t=t||n.noop;for(var i in e)(({})).hasOwnProperty.call(e,i)&&(this[i]=e[i]);return $("."+this.cssClass+" .frog-modal-body").html()?(t(this),this):(this.body=$('<div class="frog-modal-body"></div>'),this.close=$('<div class="frog-modal-close">X</div>'),this.mask=$('<div class="frog-modal-mask"></div>'),this.outer=$('<div class="frog-modal">'),$("body").append(this.outer.append(this.body.append(this.content)).append(this.close).append(this.mask).addClass(this.cssClass).css({height:this.height+"px"}).delay(500).queue(function(e){t(r),e()})),this.close.unbind().bind("click",this.hide),this.mask.unbind().bind("click",this.hide),$(document).on("keyup",function(e){e.keyCode===n.KEYCODE_ESC&&r.hide()}),this)},hide:function(e){return log("Warning: util.modal.hide() is deprecated (at this location), has to live somewhere else."),e=e||this.afterHide||n.noop,$("html").removeClass("frog-modal-in").addClass("frog-modal-out"),$(document).off("mousewheel",n.mouseWheelListener),typeof e=="function"&&e(this),this},show:function(e){return log("Warning: util.modal.show() is deprecated (at this location), has to live somewhere else."),e=e||this.afterShow||n.noop,$("html").removeClass("frog-modal-out").addClass("frog-modal-in"),$(document).on("mousewheel",n.mouseWheelListener),typeof e=="function"&&e(this),this},destroy:function(e){return log("Warning: modal.destroy() is deprecated (at this location), has to live somewhere else."),e=e||n.noop,this.outer.detach(),typeof e=="function"&&e(this),this}},noop:function(){return!0},parseCookie:function(e){var t={},n=e.cookie;return n&&n.split(";").forEach(function(e){var n=e.split("=");t[n.shift().trim()]=n.join("=")}),t},timestamp:function(){return(new Date).getTime()},time:function(){return(new Date).toLocaleString()},validate:function(e,t,n){if(!e||_.isEmpty(e))return n("00003");for(var r=0;r<t.length;r++)if(typeof e[t[r]]=="undefined")return n("00004");n(null)}};return n}),define("src/xhr",["superagent","./util"],function(e,t){return e.end=function(e){return e=e||t.noop,this.run(function(t){return t.error?e(!0,t.error,t.status,"XHR_ERROR",t):t.body&&t.body.status>=400?e(!0,t.body,t.body.status,t.body.code,t):e(null,t.body,t.body.status,t.body.code,t)})},e.get=function(t,n,r){var i=e("GET",t);return i.run=i.end,i.end=function(){e.end.apply(i,arguments)},"function"==typeof n&&(r=n,n=null),n&&i.query(n),r&&i.end(r),i},e.head=function(t,n,r){var i=e("HEAD",t);return i.run=i.end,i.end=function(){e.end.apply(i,arguments)},"function"==typeof n&&(r=n,n=null),n&&i.send(n),r&&i.end(r),i},e.del=function(t,n){var r=e("DELETE",t);return r.run=r.end,r.end=function(){e.end.apply(r,arguments)},n&&r.end(n),r},e.patch=function(t,n,r){var i=e("PATCH",t);return i.run=i.end,i.end=function(){e.end.apply(i,arguments)},"function"==typeof n&&(r=n,n=null),n&&i.send(n),r&&i.end(r),i},e.post=function(t,n,r){var i=e("POST",t);return i.run=i.end,i.end=function(){e.end.apply(i,arguments)},"function"==typeof n&&(r=n,n=null),n&&i.send(n),r&&i.end(r),i},e.put=function(t,n,r){var i=e("PUT",t);return i.run=i.end,i.end=function(){e.end.apply(i,arguments)},"function"==typeof n&&(r=n,n=null),n&&i.send(n),r&&i.end(r),i},e}),define("src/Base",["./Inherit","./util","underscore","./xhr"],function(e,t,n,r){return Class.extend({_ctor:function(e){return this.$={},e&&n.extend(this.$,e),this},get:function(e){e=e||null;if(!e)return this.$;if(e){var n=e.split("."),r=t.deepextend(!0,{},this.$);for(var i=0;i<n.length;i++){if(!r.hasOwnProperty(n[i]))return undefined;r=r[n[i]]}return r}if(!e)return this.$},set:function(e,t){e=e||null,t=t||null;if(!e&&!t)return!1;if(n.isArray(e)){for(var r=0;r<e.length;r++)this.set(e[r]);return this}if(n.isObject(e)){for(var r in e)this.set(r,e[r]);return this}if(n.isString(e)){var i=!1,s=e,o,u=this.$,a=e.split(".");for(var r=0;r<a.length;r++)o=a[r],r<a.length-1?(u[o]||(i=!0),u[o]=u[o]||{}):u[o]=t,u=u[o];return this}},noop:function(){return log("Warning: Base.noop() is deprecated, consider using frog.util.noop()"),logTrace(),!0}})}),define("src/Flow",["./Inherit","./util","underscore"],function(e,t,n){var r=Class.extend({_ctor:function(e){return this.$={last:null,idle:!0,jobs:[],vars:{},done:null,dead:!1,name:null},e&&n.extend(this.$,e),this},_setFlow:function(e,t){switch(arguments.length){case 0:return this;case 1:e=e||null,t=!1;break;default:e=e||null,t=t||!1}t?(this.$.last==="par"?this.$.jobs[this.$.jobs.length-1].push(e):this.$.jobs.push([e]),this._setLast("par")):(this.$.jobs.push(e),this._setLast("seq"))},_setLast:function(e){return e=e||"seq",this.$.last=e,this},_next:function(e){var t=this,r=function(e,n){e.shift();if(e.length>0){if(!t.$.dead)return t._next(e);if(n)return n();t.$.done.call(t,null,t.$.data)}else{if(n)return n();t.$.done.call(t,null,t.$.data)}},i=function(e,n){n=n||null;if(e[0].callback.length)e[0].callback.call(t,function(i,s){if(e[0].name==="__die__")return r(e,n);e[0].name&&t.set(e[0].name,s||null),r(e,n)});else{var i=e[0].callback.call(t);if(e[0].name==="__die__")return r(e,n);e[0].name&&t.set(e[0].name,i||null),r(e,n)}};if(this.$.dead)return this.$.done.call(this,null,this.$.data);if(n.isArray(e[0]))if(e[0].length>0){var s=e[0].length,o=0;for(var u=0;u<s;u++)i([e[0][u]],function(){o+=1;if(o>=s)return e.shift(),t._next(e)})}else e.length>0?i(e):this.$.done.call(this,null,this.$.data);else e.length>0?i(e):this.$.done.call(this,null,this.$.data)},die:function(e,t){var r=this;if(this.$.idle)return this.$.jobs.push({name:"__die__",callback:function(){return r.die.call(r,e)}}),this;if(e||e===!1)if(n.isFunction(e))this.$.dead=!0,this.$.done=e;else if(e===!0)this.$.dead=!0,n.isFunction(t)&&(t.length?t(!1):this.$.done=t);else{if(!n.isFunction(t))return t||!1;t.length?t(!0):this.$.done=t}else this.$.dead=!0},end:function(e){e=e||t.noop,this.$.idle=!1,this.$.done=e,this._next(this.$.jobs)},get:function(e){return e=e||null,e?this.$.vars[e]:this.$.vars},par:function(e,n){switch(arguments.length){case 0:return this;case 1:n=e,e=null;break;default:n=n||t.noop,e=e||null}return this._setFlow({name:e,callback:n},"par"),this},parEach:function(e){var t=this;for(var n=0;n<e.length;n++)(function(e,n){t.par(e[n])})(e,n);return this},seq:function(e,n){switch(arguments.length){case 0:return this;case 1:n=e,e=null;break;default:n=n||t.noop,e=e||null}return this._setFlow({name:e,callback:n}),this},seqEach:function(e){var t=this;for(var n=0;n<e.length;n++)(function(e,n){t.seq(e[n])})(e,n);return this},set:function(e,t){return e=e||null,t=t||null,e?(this.$.vars[e]=t,this):this}}),i=function(e){return new r(e)},s=function(e,n){switch(arguments.length){case 0:return new r;case 1:n=e,e=null;break;default:n=n||t.noop,e=e||null}var i=new r;return i.par.call(i,e,n),i},o=function(e){var t=new r;return t.parEach.call(t,e),t},u=function(e,n){switch(arguments.length){case 0:return new r;case 1:n=e,e=null;break;default:n=n||t.noop,e=e||null}var i=new r;return i.seq.call(i,e,n),i},a=function(e){var t=new r;return t.seqEach.call(t,e),t};return{init:i,par:s,parEach:o,seq:u,seqEach:a}}),define("src/Api",["./Base","./Flow","./util","./xhr"],function(e,t,n,r){return e.extend({_ctor:function(e){return this.$={context:null,endpoint:"/api",headers:{"Content-Type":"application/json"},host:null,port:null,protocol:"https"},e&&_.extend(this.$,e),this},_setUrl:function(e){if(e.substr(0,4)==="http")return e;var t="";return this.$.protocol&&(t+=this.$.protocol+"://"),this.$.host&&(t+=this.$.host),this.$.port&&(t+=":"+this.$.port),this.$.endpoint&&(t+=this.$.endpoint),this.$.context&&(t+=this.$.context),t+=e,t},del:function(){arguments[0]=this._setUrl(arguments[0]);var e=r.del.apply(r,arguments);return this.$.headers&&e.set(this.$.headers),e},get:function(){arguments[0]=this._setUrl(arguments[0]);var e=r.get.apply(r,arguments);return this.$.headers&&e.set(this.$.headers),e},post:function(){arguments[0]=this._setUrl(arguments[0]);var e=r.post.apply(r,arguments);return this.$.headers&&e.set(this.$.headers),e},put:function(){arguments[0]=this._setUrl(arguments[0]);var e=r.put.apply(r,arguments);return this.$.headers&&e.set(this.$.headers),e}})}),define("src/Collection",["./Base","./util"],function(e,t){return e.extend({_ctor:function(e){return this.$={api:null,data:[],dataScope:[],endpoint:"/",index:"_id",Model:[],model:null,offset:0,limit:100,scope:null,scopes:{}},e&&_.extend(this.$,e),this},getById:function(e){var t=this.$.index,n=this.$.data||[];for(var r=0;r<n.length;r++)if(n[key]===e)return n[key];return null},getByProperty:function(e,t){var n=this.$.data||[],r=[];for(var i=0;i<n.length;i++)n[e]===t&&r.push(n[e]);return r.length===0?null:r},setById:function(e,t){var n=this.$.index,r=this.$.data||[];for(var i=0;i<r.length;i++)if(r[key]===e)return _.extend(r[key],t),r[key];return null},index:function(e,n){switch(arguments.length){case 0:e=null,n=t.noop;break;case 1:_.isFunction(e)?(n=e,e=null):(n=t.noop,e=e||{});break;default:e=e||{},n=n||t.noop}var r=this,i=this.$.api,s=this.$.url,o=!e||typeof e.limit=="undefined"?r.get("limit"):e.limit,u=!e||typeof e.offset=="undefined"?r.get("offset"):e.offset;i.get(s).query({limit:o,offset:u}).end(function(e,t,i){if(e||t.error)return console.log("o(O",e,t,i),n(!0);var s=r.$.data||[],a=0;s.length<u&&(a=u-s.length,u-=a);var f=u+a,l=f+o,c=0;for(var h=0;h<l;h++)h<f?s[h]=s[h]||null:(s[h]=t.data[c]||null,c++);r.$.data=s,n(null,s)})},update:function(e,n){var r=this;switch(arguments.length){case 0:e=null,n=t.noop;break;case 1:_.isFunction(e)?(n=e,e=null):(n=t.noop,e=e||{});break;default:e=e||{},n=n||t.noop}var i=e.id,s=e.data||{},o=this.setById(i,s);if(!o)return n(!0,null,404);if(typeof e.save!="undefined"&&e.save===!1)return n(null,o,204);var u=this.$.api,a=this.$.url+"/"+i;u.put(a).send(o).end(function(e,t,r){if(e||t.error)return console.log("o(O",e,t,r),n(!0);n(null,o,204)})},data:function(e){return e=e||null,e?this.set("data",e):this.get("data")},filter:function(e,t){var n=this.get("scopes");return n[e]=t,this.set("scopes",n),this},scope:function(e){e=e||this.get("scope")||null;var t=this.get("data");if(!e)return t;var n=this.get("scopes."+e);if(typeof n=="undefined")return[];var r=n(t);return this.set("dataScope",r),r}})}),define("src/singleton",[],function(){var e={app:null,api:null,clients:null,components:{},config:null,resources:null,server:null,text:{}};return e}),define("src/date",["moment"],function(e){var t={formats:{utc:"MM-DD-YYYY HH:mm:ss.sss ZZ",iso:"YYYY-MM-DDTHH:mm:ss.sss",tpl:{de:"DD.MM.YYYY - HH:mm:ss",de_day:"DD.MM.YYYY"}},getUTC:function(){var n=e.utc().format(t.formats.utc);return n},getUTCLocal:function(){var n=e().local().format(t.formats.utc);return n},as:function(n,r,i){i=i||t.formats.utc;var n=e(n,r).format(i);return n},is:function(n,r){switch(arguments.length){case 0:return null;case 1:n=n||null,r=t.formats.tpl.de;break;default:n=n||null,r=t.formats.tpl[r]||r}var n=e(n,t.formats.utc).format(r);return n}};return t}),define("src/View",["./Base","./date","./Flow","./util","ejs"],function(e,t,n,r,i){return e.extend({_ctor:function(e){return this.$={api:null,compiled:null,data:{date:t,util:r},markup:null,mode:"html",file:null,rendered:null,selector:"body"},e&&_.extend(this.$,e),this},_compile:function(){return this.$.compiled=i.compile(this.$.markup),this},_load:function(e){var t=this,n=this.$.file.split(".");n[n.length-1]!==this.$.mode&&(this.$.file=n+"."+this.$.mode);var r="text!"+this.$.file;try{this.$.markup=$("#html-"+this.$.file).html();if(this.$.markup){if(e)return e.call(this,this.$.markup);return}this.$.markup=require(r),e.call(this,this.$.markup)}catch(i){require([r],function(n){t.$.markup=n;if(e)return e.call(t,t.$.markup)})}},_render:function(){this.$.rendered=this.$.compiled(this.$.data);switch(this.$.mode){case"replaceAll":$(this.$.rendered).replaceAll(this.$.selector);break;default:$(this.$.selector)[this.$.mode](this.$.rendered)}return this},data:function(e){e=e||null;if(!e||!_.isObject(e))return this;var t=this.get("data");return _.extend(t,e),this.set("data",t),this},render:function(e,t){var i=this;switch(arguments.length){case 1:_.isFunction(e)?(t=e,e={}):(t=r.noop,e=e||{});break;default:e=e||{},t=t||r.noop}this.data(e),n.seq(function(e){if(i.$.markup)return e();i._load(function(){e()})}).seq(function(e){if(i.$.compiled)return e();i._compile(),e()}).seq(function(){i._render();if(t)return t.call(i,i.$.rendered)}).end()}})}),define("src/Component",["./Api","./Base","./singleton","./Flow","./util","./View"],function(e,t,n,r,i,s){var o=t.extend({_ctor:function(e){return this.$={data:{debug:!1,dependencies:[],version:null},config:null,el:null,meta:null,id:null,file:null,selector:null,layout:"layout",view:null},e&&_.extend(this.$,e),this._getComponent(),this._getData(),this._getFile(),this._cache(),this},_getComponent:function(){return this.$.selector="[data-component="+this.$.id+"]",this.$.el=$(this.$.selector),this},_getData:function(){return this.$.data=this.$.el.data(),this},_getFile:function(){var e="";return e+="frog",e+="/components/",e+=this.$.id,e+="/html",e+="/"+this.$.layout,this.$.file=e,this},_getModules:function(e,t){t=t||i.noop;var n=[],r={};for(var s=0;s<e.length;s++)n[s]=e[s].module,r[e[s].name]=e[s].module;return t(null,r,n)},_cache:function(){return n.components[this.$.id]=this,this},_render:function(e){e=e||i.noop;var t=this,n=new s({file:this.$.file,globals:{component:this},selector:this.$.selector});this.$.view=n,n.render(function(){e.apply(t,arguments)})},_trigger:function(){var e=this,t=this.$.config,r="";r+=t.components.paths.base+"/"+this.$.id,r+="/"+t.components.paths.root,define("frog/components/"+this.$.id,n.components[this.$.id]);try{require(r)}catch(i){require([r])}},bootstrap:function(e,t){t=t||i.noop;var s=this;n.config=this.$.config=e;var u=this.$.data;r.seq(function(t){if(typeof u=="undefined"||typeof u.dependencies=="undefined"||!_.isString(u.dependencies))return t();var n=u.dependencies.split(","),r=n.length,i=0;for(var s=0;s<n.length;s++)(new o({id:n[s]})).bootstrap(e,function(e,n){i+=1;if(i>=r)return t()})}).seq(function(e){s._render(function(){s._trigger(),t.call(s,null,s)})}).end()},id:function(e){return e=e||null,e?(this.$.id=id,this):this.$.id},require:function(e,t){t=t||i.noop;var n=this,r,s,o=e.length,u=0,a={},f=[],l=[];for(var c=0;c<e.length;c++)l[c]=e[c],function(e,r){var i="";i+="frog/components",i+="/"+n.$.id,i+="/"+e[r],require([i],function(e){var i=l[r].split("/");f[r]={name:i[i.length-1],module:e},u+=1,u>=o&&n._getModules(f,t)})}(e,c)}});return o}),define("src/Email",["underscore","./Base","./Flow","./util"],function(e,t,n,r){return t.extend({_ctor:function(t,n){return this.$={dir:null,i18n:null,password:null,protocol:"SMTP",sender:{email:null,name:null,service:"Gmail",user:null,password:null},state:"idle",template:null,templates:null},t&&e.extend(this.$,t),this._setDir(),this._setTransport(),this},_setData:function(t){return e.extend(t,{i18n:this.$.i18n})},_setDir:function(e){var t=this;e=e||r.noop,templates(this.$.dir,function(n,r){if(n)return e(!0,null,400,"ERROR_EMAIL_TEMPLATES_COULD_NOT_BE_LOADED");t.$.templates=r,t.$.state="ok",e(null,null,200)})},_setTransport:function(){return this.$.transport=nodemailer.createTransport({auth:{user:this.$.sender.user,pass:this.$.sender.password},service:this.$.sender.service}),this},send:function(e,t){t=t||r.noop;var i=this;n.seq(function(e){var t=this;if(i.$.state==="ok")return e();i._setDir(e)}).seq(function(n){var r=this,s=i._setData(e.data);i.$.templates(e.template,s,function(e,i,s){if(e)return t(!0,null,400,"ERROR_EMAIL_NOT_RENDERED");r.set("html",i),r.set("text",s),n()})}).seq(function(n){var r=this,s={from:i.$.sender.name+" <"+i.$.sender.email+">",to:"<"+e.email+">",subject:e.subject,html:r.get("html")};i.$.transport.sendMail(s,function(e,n){if(e)return t(!0,null,400,"ERROR_EMAIL_NOT_SENT");t(null,n,200)})}).end()}})}),define("src/Events",["./Base"],function(e){return e.extend({_ctor:function(e){return this.$={events:{},maxListeners:10},e&&_.extend(this.$,e),this},_normalizeType:function(e){var t,n,r;switch(e.length){case 3:t=e[0],n=e[1],r=e[2],n=t.get&&t.id()!==null?t.id()+":"+n:"_global:"+n;break;default:n="_global:"+e[0],r=e[1]}return{type:n,listener:r}},setMaxListeners:function(e){return e=e||null,e&&!_.isNumeric(e)?(this.error.logger({type:"warning","class":"Events",method:".setMaxListeners()",msg:"param `num` of wrong type, must be numeric",data:arguments,file:"Events.js"}),!1):(e&&(e=parseInt(e),this.$.maxListeners=e),e?this:this.$.maxListeners)},emit:function(){var e,t,n,r,i=[];for(e=0;e<arguments.length;e++)switch(e){case 0:_.isString(arguments[e])?(r=arguments[e],n=null):(r=r||null,n=arguments[e]);break;case 1:_.isString(arguments[e])?r=arguments[e]:(r=r||null,i.push(arguments[e]));break;default:i.push(arguments[e])}if(r&&_.isArray(r)){for(e=0;e<r.length;e++)n?t=[n,r[e]]:t=[r[e]],t.concat(i),this.emit.apply(this,t);return this}if(!r||!_.isString(r))return this.error.logger({type:"warning","class":"Events",method:".emit()",msg:"param `type` of wrong type, must be string",data:r,file:"Events.js"}),!1;r=n&&n.get&&n.id()!==null?n.id()+":"+r:"_global:"+r;var s,o;this.$.events=this.$.events||{},s=this.$.events[r]||null;if(!s)return!1;if(s&&!_.isFunction(s)&&!_.isArray(s))return this.error.logger({type:"warning","class":"Events",method:".emit()",msg:"`handler` of wrong type, must be function or array of functions",data:s,file:"Events.js"}),!1;var u,a;if(_.isFunction(s))return i.length===0?s.call(this):s.apply(this,i),!0;if(_.isArray(s)){o=s.slice();for(e=0,u=o.length;e<u;e++)o[e].apply(this,i);return!0}},addListener:function(e,t){e=e||null,t=t||null;if(!_.isFunction(t)&&!_.isArray(t))return;var n;if(_.isArray(e)){for(n=0;n<e.length;n++)this.addListener(e[n],t);return this}if(_.isArray(t)){for(n=0;n<t.length;n++)this.addListener(e,t[n]);return this}this.$.events.newListener&&this.emit("newListener",e,_.isFunction(t.listener)?t.listener:t),this.$.events[e]?_.isArray(this.$.events[e])?this.$.events[e].push(t):this.$.events[e]=[this.$.events[e],t]:this.$.events[e]=t;if(_.isArray(this.$.events[e])&&!this.$.events[e].warned){var r;r=this.$.maxListeners,r&&r>0&&this.$.events[e].length>r&&(this.$.events[e].warned=!0,this.error.logger({type:"warning","class":"Events",method:".addListener()",msg:"LEAK! Too many listeners!",data:arguments,file:"Events.js"}))}return this},addListenerOnce:function(e,t){function i(){n.removeListener(e,i),t.apply(this,arguments)}e=e||null,t=t||null;if(!_.isFunction(t)&&!_.isArray(t))return this.error.logger({type:"warning","class":"Events",method:".addListenerOnce()",msg:"`listener` of wrong type, must be function or array of functions",data:arguments,file:"Events.js"}),!1;var n=this,r;if(_.isArray(e)){for(r=0;r<e.length;r++)this.addListenerOnce(e[r],t);return this}if(_.isArray(t)){for(r=0;r<t.length;r++)this.addListenerOnce(e,t[r]);return this}return i.listener=t,n.on(e,i),this},removeListener:function(e,t){e=e||null,t=t||null;if(e&&!t)return this.removeAllListeners(e),!1;if(t&&!_.isFunction(t))return this.error.logger({type:"warning","class":"Events",method:".removeListener()",msg:"`listener` of wrong type, must be function",data:arguments,file:"Events.js"}),!1;if(!this.$.events||!this.$.events[e])return this;var n,r;n=this.$.events[e];if(_.isArray(n)){r=-1;for(var i=0,s=n.length;i<s;i++)if(n[i]===t||n[i].listener&&n[i].listener===t){r=i;break}if(r<0)return this;n.splice(r,1),n.length==0&&delete this.$.events[e],this.$.events.removeListener&&this.emit("removeListener",e,t)}else if(n===t||n.listener&&n.listener===t)delete this.$.events[e],this.$.events.removeListener&&this.emit("removeListener",e,t);return this},removeAllListeners:function(e){if(!this.$.events)return this;if(!this.$.events.removeListener)return arguments.length===0?this.$.events={}:e&&this.$.events&&this.$.events[e]&&(this.$.events[e]=null),this;if(arguments.length===0){for(var t in this.$.events){if(t==="removeListener")continue;this.removeAllListeners(t)}return this.removeAllListeners("removeListener"),this.$.events={},this}var n;n=this.$.events[e];if(_.isArray(n))while(n.length)this.removeListener(e,n[n.length-1]);else n&&this.removeListener(e,n);return this.$.events[e]=null,this},listeners:function(e){e=e||null;if(e&&!_.isString(e))return;if(e)return this.$.events[e]?_.isArray(this.$.events[e])?this.$.events[e].slice(0):[this.$.events[e]]:[];if(!e)return this.$.events},on:function(e,t,n){var r;return r=this._normalizeType(arguments),this.addListener(r.type,r.listener),this},once:function(e,t,n){var r;return r=this._normalizeType(arguments),this.addListenerOnce(r.type,r.listener),this},off:function(e,t,n){var r;return r=this._normalizeType(arguments),this.removeListener(r.type,r.listener),this},offAll:function(e,t,n){var r;return r=this._normalizeType(arguments),this.removeAllListeners(r.type,r.listener),this}})}),define("src/Events.Singleton",["./Events"],function(e){return new e}),define("src/Facebook",["./Base","./Flow","./util","./xhr"],function(e,t,n,r){return e.extend({_ctor:function(e){return this.$={appId:null,cookie:!1,endpoint:null,frictionlessRequests:!1,friends:[],friendsInvitable:[],hideFlashCallback:null,locale:"de_DE",login:null,permissions:[],permissionsSet:[],sdk:"//connect.facebook.net/[1]/sdk.js",status:!1,user:null,version:"v2.0",xfbml:!1},e&&_.extend(this.$,e),this._setEndpoint(),this},_setEndpoint:function(){return this.$.endpoint=this.$.sdk.replace("[1]",this.$.locale),this},_getFriends:function(e){var t=this;e=e||n.noop},_getFriendsInvitable:function(e){var r=this;e=e||n.noop,t.seq(function(t){r._getStatus(function(n,r,i,s){if(n)return e(n,r,i,s);t()})}).seq(function(t){FB.api("/me/invitable_friends",function(t){log(t);if(t&&!t.error)return e(!0,t.error,400,"facebook_api_error");r.$.friendsInvitable=t.data,e(null,r.$.friendsInvitable,200)})}).end()},_getFriendsKnown:function(e){var t=this;e=e||n.noop,FB.api("/me/friends",function(n){log(n);if(n&&!n.error)return e(!0,n.error,400,"facebook_api_error");t.$.friends=n.data||[],e(null,t.$.friends,200)})},_getPermissions:function(e){var r=this;e=e||n.noop,t.seq(function(t){r._getLoginStatus(function(n,r,i,s){if(n)return e(n,r,i,s);t()})}).seq(function(t){FB.api("/me/permissions",function(t){if(t&&!t.error)return e(!0,t.error,400,"facebook_api_error");r.$.permissionsSet=t.data,e(null,r.$.permissionsSet,200)})}).end()},_getSdk:function(e){var t=this;e=e||n.noop,window.fbAsyncInit=function(){FB.init({appId:t.$.appId,cookie:t.$.cookie,frictionlessRequests:t.$.frictionlessRequests,hideFlashCallback:t.$.hideFlashCallback,status:t.$.status,version:t.$.version,xfbml:t.$.xfbml}),e()},function(e,n,r){var i,s=e.getElementsByTagName(n)[0];if(e.getElementById(r))return;i=e.createElement(n),i.id=r,i.src="//connect.facebook.net/"+t.$.locale+"/sdk.js",s.parentNode.insertBefore(i,s)}(document,"script","facebook-jssdk")},_getStatus:function(e){var r=this;e=e||n.noop,t.seq(function(e){FB.getLoginStatus(function(t){r.set("login",t),e()})}).seq(function(t){switch(r.$.login.status){case"connected":return r.$.user={},e(null,200,r.$.login);case"not_authorized":return e(!0,401,r.$.login);default:return e(!0,401,r.$.login)}}).end()},_getUser:function(e){var t=this;FB.api("/me",function(n){if(n&&n.error)return e(!0,n,400,"BAD_REQUEST");t.$.user=_.extend(t.$.user,n),e(null,t.$.user,200)})},_getUserImage:function(e){var t=this;FB.api("/me/picture",{height:"200",redirect:"false",type:"normal",width:"200"},function(n){if(n&&n.error)return e(!0,n,400,"BAD_REQUEST");t.$.user=_.extend(t.$.user,{picture:n.data}),e(null,t.$.user,200)})},friends:function(e,t){var r=this;switch(arguments.length){case 1:_.isFunction(e)?(t=e,e=null):(e=e||null,t=n.noop);break;default:e=e||null,t=t||n.noop}switch(e){case"invitable":r._getFriendsInvitable(t);break;case"known":r._getFriendsKnown(t);break;default:r._getFriends(t)}},init:function(e){var r=this;e=e||n.noop,t.seq(function(e){r._getSdk(e)}).seq(function(e){r._getStatus(e)}).par(function(e){r._getUser(e)}).par(function(e){r._getUserImage(e)}).end(function(){r.$.ready=!0,e(null,r.$.user,200)})},invite:function(e,r){var i=this;r=r||n.noop,t.seq(function(e){i._getPermissions(function(t,n,i,s){if(t)return r(t,n,i,s);var o=_.find(n,function(e){e.permission==="user_friends"});if(!o)return r(!0,null,401,"missing_permissin");e()})}).seq(function(e){i._getFriendsInvite(function(t,n,i,s){if(t)return r(t,n,i,s);e()})}).seq(function(t){var n=this,s=[];for(var o=0;o<i.$.friendsInvitable.length;o++)s.push(i.$.friendsInvitable[o].id);s=s.join(","),FB.ui({method:"apprequests",message:e,to:s},function(e){if(e&&!e.error)return r(!0,e.error,400,"facebook_api_error");trc(e.data),n.set("invites",e.data),t()})}).seq(function(e){r(null,null,200)}).end()},login:function(e){var t=this;e=e||n.noop,frog.Flow.seq(function(n){var r=t.$.permissions||[];FB.login(function(r){return r.status==="connected"?(t.$.user=r.authResponse,n()):(t.$.login=r,e(!0))},{scope:r.join(",")})}).par(function(e){t._getUser(e)}).par(function(e){t._getUserImage(e)}).end(function(){e(null,t.$.user,200)})},ready:function(){return this.$.ready||!1}})}),define("src/validations",["./util"],function(e){var t={ifRange:function(e,n,r){var i=!1;e&&e!==""&&(i=t.isRange(e,n,r))},isChecked:function(e,t,n){var r=!1;return r=$("[name="+t[1]+"]").is(":checked"),n(!r)},isCreditCard:function(e,t,n){var r=!1;if(/[^0-9 \-]+/.test(e))return n(!0);var i=0,s=0,o=!1,u,a;e=e.replace(/\D/g,"");if(e.length<13||e.length>19)return!1;for(u=e.length-1;u>=0;u--)a=e.charAt(u),s=parseInt(a,10),o&&(s*=2)>9&&(s-=9),i+=s,o=!o;return r=i%10===0,n(!r)},isEmail:function(e,t,n){var r=!1,i=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return r=i.test(e),n(!r)},isEmails:function(e,t,n){var r=!1;return n(!r)},isEnum:function(e,t,n){var r=!1;return t.splice(0,1),t.indexOf(e)>-1&&(r=!0),n(!r)},isEqualTo:function(e,t,n){var r=!1;return r=e===t[1],n(!r)},isEqualToField:function(e,t,n){var r=!1,i=$("[name="+t[1]+"]",this.$.el).val();return r=i===e,n(!r)},isInList:function(e,t,n){var r=!1,i=$("[name="+t[1]+"]",this.$.el),s;return $("option",i).each(function(){s=$(this).val(),s!==""&&s===e&&(r=!0)}),n(!r)},isMax:function(e,t,n){var r=!1;return e=parseInt(e),r=e<=t[1],n(!r)},isMaxLength:function(e,t,n){var r=!1;return r=e.length<=t[1],n(!r)},isMin:function(e,t,n){var r=!1;return e=parseInt(e),r=e>=t[1],n(!r)},isMinLength:function(e,t,n){var r=!1;return r=e.length>=t[1],n(!r)},isNoop:function(e,t,n){var r=!0;return n(!r)},isRange:function(e,t,n){var r=!1;return e=parseInt(e),r=e>=parseInt(t[1])&&e<=parseInt(t[2]),n(!r)},isRangeLength:function(e,t,n){var r=!1;return r=e.length>=t[1]&&e.length<=t[2],n(!r)},isNumbersOnly:function(e,t,n){var r=!1;return r=/^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(e),n(!r)},isOptional:function(t,n,r){var i=!1;return typeof t=="undefined"||t===null||t===""?r():(i=e.trim(t).length>=1,r(!i))},isRequired:function(t,n,r){var i=!1;return t&&(i=e.trim(t).length>0),r(!i)}};return t}),define("src/Handler.Form",["./Base","./date","./Flow","./util","./validations"],function(e,t,n,r,i){return e.extend({_ctor:function(e){return this.$={action:!0,css:{field:"field",fieldError:"field-error",fieldErrorMessage:"field-error-message",fieldErrorFlag:"field-error-flag",fieldSuccess:"field-success",fieldSuccessFlag:"field-success-flag",form:"form",formBusy:"form-busy",formCancel:"form-cancel",formError:"form-error",formErrorMessage:"form-error-message",formNative:"form-native",formSubmit:"form-submit"},data:{},el:null,endpoint:"/",errors:null,errors_all:!1,fields:{},globals:{date:t,util:r},listeners_fields:!1,listeners_forms:!1,markup:{error_field:"",error_form:""},method:"POST",namespace:null,prefix:"frog-",rules:{},selector:"form",state:"loaded",text:{},valid:!0,validations:i,view:null},e&&_.extend(this.$,e),this._setPrefix(),this},_busy:function(e){e=e||null;var t=this.$.selector+" ",n=this.$.css;return e?(this.$.state="busy",$(t).addClass(n.formBusy)):(this.$.state="idle",$(t).removeClass(n.formBusy)),this},_getForm:function(){return this.$.el=$(this.$.selector),this.$.el.prepend(this.$.markup.error_form),this.$.el},_getFields:function(){var e=this;this.$.fields={};var t=this.$.selector+" ",n=this.$.css;return $(t+"."+n.field+" [name]").each(function(){var r=$(this),i=r.attr("name"),s=r.attr("type")?r.attr("type"):null;i&&i!==""&&(e.$.fields[i]={el:r,name:i,valid:null,tag:r.prop("tagName").toLowerCase(),type:s,value:null},s!=="checkbox"&&s!=="radio"&&r.closest(t+"."+n.field).append(e.$.markup.error_field))}),this.$.fields},_getResults:function(){return{body:this.$.data,fields:this.$.fields,errors:this.$.errors,valid:this.$.valid}},_setPrefix:function(){for(var e in this.$.css)this.$.css[e]=this.$.prefix+this.$.css[e];return this},_setErrorMessage:function(e){var t=this.$.rules[e]||[],n,r,i,s=this.$.errors[e],o="",u=[];for(var a=0;a<s.length;a++){r=s[a],i=this.$.text[r],n=_.isArray(t[1])?t[1]:null;if(n)for(var a=1;a<n.length;a++)i=i.replace("["+a+"]",n[a]);o!==""&&(o+="</br>"),o+=i,u.push(i)}return this.$.errors_all?o:u[u.length-1]},_setFieldListeners:function(){var e=this,t=this._getForm(),n=this._getFields(),r=this.$.selector+" ",i=this.$.css,s=this.$.text,o=function(t){e.validate(t)},u=function(e,t,n){switch(t){case"select":$(document).on("change",r+"[name="+e+"]",function(t){o(e)});break;default:switch(n){case"checkbox":$(document).on("click",r+"[name="+e+"]",function(t){o(e)});break;case"hidden":$(document).on("change",r+"[name="+e+"]",function(t){o(e)});break;case"range":$(document).on("input",r+"[name="+e+"]",function(t){o(e)});break;default:$(document).on("blur",r+"[name="+e+"]",function(t){t.preventDefault(),o(e)})}}};for(var a in n)u(a,n[a].tag,n[a].type);return this},_setFormListener:function(){var e=this,t=this.$.selector+" ",n=this.$.css;$(document).on("click",t+"."+n.formCancel+" a",function(t){t.preventDefault(),e.done()}),$(document).on("click",t+"."+n.formSubmit+" a",function(e){e.preventDefault(),$(this).submit()}),$(document).on("submit",t,function(t){var r=$(this);r.hasClass(n.formNative)?r.removeClass(n.formNative):(t.preventDefault(),e._submit())})},_setMarkup:function(){var e=this.$.css,t=this.$.prefix;return _.extend(this.$.markup,{error_field:'<div class="'+e.fieldErrorMessage+'"></div><div class="'+e.fieldErrorFlag+'">'+this.$.text.defaultError+'</div><div class="'+e.fieldSuccessFlag+'">'+this.$.text.defaultSuccess+"</div>",error_form:'<div class="'+e.formErrorMessage+'">'+this.$.text.formError+"</div>"}),this},_setStateClasses:function(e,t){var n=this.$.text,r=this.$.selector+" ",i=this.$.css,s=$(r+"[name="+e+"]"),o=s.closest("."+i.field),u=s.attr("name"),a=!1;this.$.errors&&this.$.errors[e]&&_.isArray(this.$.errors[e])&&this.$.errors[e].length>0&&(a=!0);if(a){o.addClass(i.fieldError),o.removeClass(i.fieldSuccess);var f=this._setErrorMessage(u);$("."+i.fieldErrorMessage,o).html(f)}else o.removeClass(i.fieldError),o.addClass(i.fieldSuccess),$("."+i.fieldErrorMessage,o).html("");this.$.valid?($("."+i.formErrorMessage,this.$.el).html(""),$(r).removeClass(i.formError)):($("."+i.formErrorMessage,this.$.el).html(this.$.text.form),$(r).addClass(i.formError))},_submit:function(){var e=this,t=this.$.css;if(this.$.state!=="idle")return!1;this.validate(function(n,r){e._busy(!0);if(!r.valid)return e._busy(!1);if(e.$.action===!0){var i=e.$.el;return i.addClass(t.formNative),i.submit()}if(e.$.action&&_.isFunction(e.$.action))return e.$.action.call(e,null,r)})},done:function(e){e=e||null;var t=this.$.selector+" ",n=this.$.css;if(e){var r=this.$.el.closest(n.field);return r.removeClass(n.fieldError+" "+n.fieldSuccess),this}return this.$.el.removeClass(n.formBusy+" "+n.formError),$("."+n.field,this.$.el).each(function(){$(this).removeClass(n.fieldError+" "+n.fieldSuccess)}),this._busy(!1),this},data:function(e){return e=e||null,e?(_.extend(this.$.globals,{form:this.$}),_.extend(this.$.globals,e),this):this.$.globals},error:function(e,t){e=e||null;var n=this.$.errors||{};typeof n[e]=="undefined"&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t),_.isEmpty(n)&&(n=null),this.$.errors=n,this.$.valid=typeof this.$.errors=="undefined"||!!_.isEmpty(this.$.errors);var r=this._getResults();return this._setStateClasses(e,r),this},fetch:function(e){e=e||null;var t={},n=this.$.el.serializeArray();for(var r=0;r<n.length;r++)t[n[r].name]=n[r].value;return this.$.data=t,t},idle:function(){return this._busy(!1),this},init:function(){var e=this.$.selector+" ",t=this.$.css;return this._setMarkup(),this._setFieldListeners(),this._setFormListener(),this.$.state="idle",$(e+"."+t.formSubmit+" button").removeAttr("disabled"),this},redirect:function(e){return e=e||this.$.redirect||null,e?window.location.href=e:this},render:function(e,t){switch(arguments.length){case 0:e=null,t=r.noop;break;case 1:_.isFunction(e)?(t=e,e=null):(e=e||null,t=r.noop);break;default:t=t||r.noop,e=e||null}var n=this;e&&this.data(e),this.$.view.render(this.$.globals,function(){n.init(),t()})},reset:function(e){e=e||null,this.done();var t;return e?t=$(this.$.selector+" [name="+e+"]"):t=$(this.$.selector+" [name]"),t.val(""),t.prop("checked",!1),t.prop("selectedIndex",0),this},send:function(e){return this.$.action=e,this},success:function(e){return e=e||null,this},test:function(e,t){if(_.isArray(e)){for(var n=0;n<e.length;n++)this.test(e[n]);return this}if(_.isObject(e)){for(var r in e)this.test(r,e[r]);return this}t=t||null;if(!t)return this;if(typeof this.$.rules[e]=="undefined")this.$.rules[e]=t;else for(var n=0;n<t.length;n++)this.$.rules[e].push(t[n]);return this},text:function(e){return e=e||null,e?(_.extend(this.$.text,e),this):this.$.text},validate:function(e,t){switch(arguments.length){case 1:_.isFunction(e)?(t=e,e=null):(e=e||null,t=r.noop);break;default:e=e||null,t=t||r.noop}var n=this,i,s=function(t,r){var i=n.$.errors||{};if(t)typeof i[e]=="undefined"&&(i[e]=[]),i[e].indexOf(v)===-1&&i[e].push(v);else if(i!==null&&typeof i[e]!="undefined"){var s=i[e].indexOf(v);i[e].splice(s,1),i[e].length===0&&delete i[e]}_.isEmpty(i)&&(i=null),n.$.errors=i,n.$.valid=typeof n.$.errors=="undefined"||!!_.isEmpty(n.$.errors),r()};n._busy(!1);if(!e){var o=[];for(var u in this.$.fields)o.push(this.$.fields[u]);var a=0,f=o.length;for(var l=0;l<o.length;l++)this.validate(o[l].name,function(){a+=1;if(a>=f)return i=n._getResults(),t(null,i)});return this}var c=this.fetch(e)[e],h=this.$.rules[e]||[],f=h.length,a=0,p,d,v,m;for(var l=0;l<h.length;l++)p=h[l],_.isArray(p)?(v=p[0],_.isFunction(p[1])?d=p[1]:d=n.$.validations[v]):_.isFunction(p)?d=p:(v=p,p=[],d=n.$.validations[v]),d.call(n,c,p,function(r){a+=1,s(r,function(){a>=f&&(i=n._getResults(),n._setStateClasses(e,i),t(null,i))})})},validations:function(e){return _.extend(this.$.validations,e),this},exec:function(e,t){return this.validate.apply(this,arguments)}})}),define("src/Handler.Object",["./Base","./date","./Flow","./util","./validations"],function(e,t,n,r,i){return e.extend({_ctor:function(e){return this.$={body:null,errors:null,errors_all:!1,rules:{},valid:!0,validations:i},e&&_.extend(this.$,e),this},_getResults:function(){return{body:this.$.body,errors:this.$.errors,valid:this.$.valid}},data:function(e){return e=e||{},this.set("body",e),this},test:function(e,t){if(_.isArray(e)){for(var n=0;n<e.length;n++)this.test(e[n]);return this}if(_.isObject(e)){for(var n in e)this.test(n,e[n]);return this}t=t||null;if(!t)return this;if(typeof this.$.rules[e]=="undefined")this.$.rules[e]=t;else for(var n=0;n<t.length;n++)this.$.rules[e].push(t[n]);return this},validate:function(e,t){switch(arguments.length){case 1:_.isFunction(e)?(t=e,e=null):(e=e||null,t=r.noop);break;default:e=e||null,t=t||r.noop}var n=this,i,s=function(t,r){var i=n.$.errors||{};if(t){typeof i[e]=="undefined"&&(i[e]=[]);var s=-1;for(var o=0;o<i[e].length;o++)i[e][o].field===e&&(s=o);s===-1&&i[e].push({field:e,name:d,rule:h,value:n.$.body[e]})}else if(i&&typeof i[e]!="undefined"){var s=-1;for(var o=0;o<i[e].length;o++)i[e][o].field===e&&(s=o);s>-1&&i[e].splice(s,1),i[e].length===0&&delete i[e]}_.isEmpty(i)&&(i=null),n.$.errors=i,n.$.valid=typeof n.$.errors=="undefined"||!!_.isEmpty(n.$.errors),r()};if(!e){var o=[];for(var u in this.$.body)o.push(u);var a=0,f=o.length;for(var u=0;u<o.length;u++)this.validate(o[u],function(){a+=1;if(a>=f)return i=n._getResults(),i.valid?t(null,i,200,"OK"):t(!0,i,409,"ERROR_VALIDATION")});return this}var l=this.$.body[e],c=this.$.rules[e]||["isNoop"],f=c.length,a=0,h,p,d,v;for(var u=0;u<c.length;u++)h=c[u],_.isArray(h)?(d=h[0],_.isFunction(h[1])?p=h[1]:p=n.$.validations[d]):_.isFunction(h)?p=h:(d=h,h=[],p=n.$.validations[d]),p.call(n,l,h,function(e){a+=1,s(e,function(){if(a>=f){i=n._getResults();if(!i.valid)return t(!0,i,409,"ERROR_VALIDATION");t(null,i,200)}})})},exec:function(e,t){return this.validate.apply(this,arguments)}})}),define("src/I18n",["./Base","./util"],function(e,t){return e.extend({_ctor:function(e){return this.$={country:null,language:null,locale:null,region:null,text:{}},e&&_.extend(this.$,e),this._setCountry(),this._setLanguage(),this._setRegion(),this._setText(),this},_setCountry:function(){return this.country=this.$.country||null,this},_setLanguage:function(){return this.language=this.$.language||null,this},_setRegion:function(){return this.region=this.$.region||null,this},_setText:function(){return this.text=this.$.text[this.$.language]||{},this},change:function(e){return e&&_.extend(this.$,e),this._setCountry(),this._setLanguage(),this._setRegion(),this._setText(),this},text:{}})}),define("src/log",[],function(){return window.log=function(){this.console&&console.log.apply(this.console,arguments)},window.trc=window.logtrace=function(){this.console&&(console.log.apply(this.console,arguments),console.log(Error().stack.replace("Error","---").replace("at Error (native)","Stack")))},{log:window.log,logtrace:window.logtrace}}),define("src/Model",["./Base"],function(e){return e.extend({_ctor:function(e){return this.$={data:null},e&&_.extend(this.$,e),this},data:function(){return this.get("data")}})}),define("src/require",["./singleton"],function(e){var t=function(e,t){var n=[],r={};for(var i=0;i<e.length;i++)n.push(e[i].module),r[e[i].name]=e[i].module;if(t)return t(null,r,n)},n=function(n,r){var i,s,o=n.length,u=0,a,f={},l=[],c=[];for(var h=0;h<n.length;h++)(function(n,i){c[i]=n[i];if(typeof server!="undefined"){var s=e.server;a=s.get("dir")+s.get("server")+"/"+n[i],l[i]={name:c[i],module:require(a)},u+=1,u>=o&&t(l,r)}else require([n[i]],function(e){l[i]={name:c[i],module:e},u+=1,u>=o&&t(l,r)})})(n,h)};return n}),define("src/Route",["./Base"],function(e){return e.extend({_ctor:function(e,t){return t=t||{},this.$={keys:[],params:null,path:e,query:null,regexp:null,uri:null},this.$.options={sensitive:!1,strict:!1},_.extend(this.$.options,t),this},_pathToRegEx:function(e,t,n,r){var i=this;return e instanceof RegExp?e:(e instanceof Array&&(e="("+e.join("|")+")"),e=e.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,n,r,s,o,u){return t.push({name:s,optional:!!u}),i.$.keys=t,n=n||"",""+(u?"":n)+"(?:"+(u?n:"")+(r||"")+(o||r&&"([^/.]+?)"||"([^/]+?)")+")"+(u||"")}).replace(/([\/.])/g,"\\$1").replace(/\*/g,"(.*)"),new RegExp("^"+e+"$",n?"":"i"))},_querystringToObject:function(e){var t=e.split("&"),n={},r;for(var i=0;i<t.length;i++)r=t[i].split("="),r[1]&&(n[decodeURIComponent(r[0])]=decodeURIComponent(r[1]));return n},init:function(){return this.$.regexp=this._pathToRegEx(this.$.path,this.$.keys,this.$.options.sensitive,this.$.options.strict),this},match:function(e,t){var n=this.$.keys,r=e.split("?")[1]||null,i=e.indexOf("?"),s=~i?e.slice(0,i):e,o=this.$.regexp.exec(s);if(!o)return!1;var u,a;for(var f=1;f<o.length;f++)u=n[f-1],a=typeof o[f]=="string"?decodeURIComponent(o[f]):o[f],u?(u.name.toLowerCase(),t[u.name]=undefined!==t[u.name]?t[u.name]:a):t.push(a);return this.$.uri=s,this.$.params=t,this.$.query=r!==null?this._querystringToObject(r):null,!0}})}),define("src/Router",["./Base","./require","./Route"],function(e,t,n){return e.extend({_ctor:function(e){return this.$={base:null,context:null,data:{},location:null,name:null,params:null,query:null,routes:[],sensitive:!1,strict:!1},e&&_.extend(this.$,e),this},_dispatch:function(e,t){t=t||0;var n=this,r=this.$.routes,i,s;for(var o=t;o<r.length;o++){if(!!i)return!0;i=r[o].route.match(e,[]);if(i===!0)return this.$.context=r[o].route.$,this.$.params=r[o].route.$.params,this.$.query=r[o].route.$.query,r[o].fn.call(n,{context:this.$.context,data:this.$.data,params:this.$.params,query:this.$.query},function(t){t&&_.extend(n.$.data,t);var i=o+1;typeof r[i]!="undefined"&&n._dispatch(e,i)}),!0}return!1},end:function(){var e=this,n=function(){e.$.location=location;var t=location.hash!==""?location.hash:null,n=location.pathname;t&&(n+=t),this.$.context&&(n=this.$.context+n),e._dispatch(n)};return t(["hashchange"],function(){$(window).hashchange(n),n()}),this},navigateTo:function(e){e=e||"/";var t=this.get("base")===null?"":this.get("base");return e=t+e,window.location.replace(e),this},setRouteCallback:function(){var e=this,t=e.$.base===null?"":e.$.base,r=Array.prototype.slice.call(arguments),i=r[0];if(i==="#/"||i==="/")i=t;return i!==t&&(i=t+i),r.splice(0,1),_.each(r,function(t){e.$.routes.push({route:(new n(i)).init(),fn:function(n,r){t.call(e,n,r)}})}),this},now:function(e){return this.navigateTo.apply(this,arguments)},add:function(){return this.setRouteCallback.apply(this,arguments)}})}),define("frog",["src/Api","src/Base","src/Collection","src/Component","src/date","src/Email","src/Events","src/Events.Singleton","src/Facebook","src/Flow","src/Handler.Form","src/Handler.Object","src/I18n","src/log","src/Model","src/require","src/Router","src/singleton","src/util","src/validations","src/View","src/xhr"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E){var S={Api:e,Base:t,Collection:n,Component:r,date:i,Email:s,Events:o,events:u,Facebook:a,Flow:f,Handler:{Form:l,Object:c},I18n:h,log:p,Model:d,require:v,Router:m,singleton:g,util:y,validations:b,View:w,xhr:E};return window.frog=S});